---
title: "Causes & Seasonality"
author: "Hela Bouhlel"
date: "2025-12-28"
format:
  html:
    theme: cosmo
    toc: true
    number-sections: true
webr:
  show-startup-message: false
  emulate-r: true
  packages: ["dplyr", "ggplot2", "tidyr"]
filters:
  - webr
---
## Introduction

Understanding the magnitude of delays is not enough; we must identify their drivers. 

This section explores the causal factors behind flight disruptions, comparing internal operational issues against external forces like weather. Furthermore, we investigate seasonality to determine if delays follow a predictable temporal rhythm throughout the year, identifying critical periods of high disruption.
```{webr-r}
url <- "https://raw.githubusercontent.com/helabhl/Flight-Delays-Analysis/refs/heads/main/qmd/data/flight_2024.csv"
df <- read.csv(url)
df <- df %>%
filter(cancelled == 0,diverted == 0,
!is.na(arr_delay))
```
## Total Delay Minutes by Cause
```{webr-r}

library(tidyr)

cause_totals <- df %>%
summarise(
carrier_delay = sum(carrier_delay, na.rm = TRUE),
weather_delay = sum(weather_delay, na.rm = TRUE),
nas_delay = sum(nas_delay, na.rm = TRUE),
security_delay = sum(security_delay, na.rm = TRUE),
late_aircraft_delay = sum(late_aircraft_delay, na.rm = TRUE)
) %>%
pivot_longer(
everything(),
names_to = "cause",
values_to = "minutes"
) %>%
mutate(share = minutes / sum(minutes))

cause_totals
```
Airline-related and late-aircraft delays account for the largest share of cumulative delay minutes,
suggesting a strong propagation effect within the air transport system.

## Visualization of Delay Causes
```{webr-r}

ggplot(cause_totals,
aes(x = reorder(cause, minutes), y = minutes)) +
geom_col(fill = "tomato") +
coord_flip() +
labs(
title = "Total Delay Minutes by Cause",
x = "Cause",
y = "Delay minutes"
)
```
Internal and operational causes dominate exogenous factors such as weather or security.

## Internal vs External Delay Sources
```{webr-r}
internal_external <- df %>%
summarise(
internal = sum(carrier_delay + security_delay, na.rm = TRUE),
external = sum(weather_delay + nas_delay + late_aircraft_delay, na.rm = TRUE)
)

internal_external
internal_external_long <- internal_external %>%
  pivot_longer(cols = everything(), names_to = "type", values_to = "delay")

ggplot(internal_external_long, aes(x = type, y = delay, fill = type)) +
  geom_bar(stat = "identity") +
  labs(title = "Retards internes vs externes",
       x = "Type de retard",
       y = "Somme des minutes de retard") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set2")

```
While external factors contribute significantly, internal causes remain a major lever
for performance improvement by airlines.

## Monthly Flight Volume
```{webr-r}
monthly_flights <- df %>%
group_by(month) %>%
summarise(total_flights = n())

ggplot(monthly_flights,
aes(x = factor(month), y = total_flights)) +
geom_col(fill = "lightblue") +
labs(
title = "Number of Arrived Flights per Month",
x = "Month",
y = "Number of flights"
) +
theme_minimal()
```
Flight volume varies across months, reflecting seasonal traffic patterns: 
* The data suggests a summer peak (July) and a fall increase (October).

* Early months (Jan–Feb) have fewer flights, possibly due to post-holiday slowdown.

* Late months (Nov–Dec) show slightly lower numbers, possibly before the holiday surge.

## Monthly Distribution of Delay Categories
```{webr-r}
df_clean <- df %>%
mutate(
delay_category = case_when(
arr_delay <= 0 ~ "On time or early",
arr_delay < 15 ~ "Delay < 15 min",
arr_delay >= 15 ~ "Delay ≥ 15 min"
)
)

monthly_delay_dist <- df_clean %>%
group_by(month, delay_category) %>%
summarise(n_flights = n(), .groups = "drop")
```


```{webr-r}
ggplot(monthly_delay_dist,
aes(x = factor(month),
y = n_flights,
fill = delay_category)) +
geom_bar(stat = "identity") +
labs(
title = "Monthly Distribution of Flights by Delay Category",
x = "Month",
y = "Number of flights",
fill = "Delay category"
) +
theme_minimal()
```
## Monthly Proportions Independent of Traffic Volume
```{webr-r}
monthly_delay_prop <- monthly_delay_dist %>%
group_by(month) %>%
mutate(prop = n_flights / sum(n_flights))

ggplot(monthly_delay_prop,
aes(x = factor(month),
y = prop,
fill = delay_category)) +
geom_bar(stat = "identity", position = "fill") +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Monthly Proportion of Delay Categories",
x = "Month",
y = "Proportion",
fill = "Delay category"
) +
theme_minimal()
```
Delay intensity varies substantially across months, combining both frequency and severity effects.

## Effect of Month on Flight Delays (Kruskal–Wallis Test)
**Research Question :**
Do arrival delays significantly differ across months of the year?

**Statistical Hypotheses**

* **H₀ (Null hypothesis)**
The distribution of arrival delays (arr_delay) is identical across all months.
→ There is no seasonal effect on flight delays.

* **H₁ (Alternative hypothesis)**
At least one month has a different delay distribution.
→ There is a significant seasonal effect on flight delays.

**Statistical Test**

A Kruskal–Wallis rank-sum test was applied because:

* arrival delays are non-normally distributed

* extreme values (outliers) are present

* more than two independent groups (12 months) are compared
```{webr-r}
kruskal.test(arr_delay ~ factor(month), data = df_clean)
```


**Decision:** Reject the null hypothesis **(H₀)**.

**Conclusion:**
Arrival delay distributions differ significantly across months, confirming the presence of a strong seasonal effect.

This seasonal variability may be explained by:

* increased demand during summer and holiday periods

* adverse weather conditions during winter months

## Flight Volume vs Delay Severity (Spearman Correlation)
**Research Question**

Do days with higher flight volumes experience more severe arrival delays?

**Statistical Hypotheses**

**H₀ (Null hypothesis)**
There is no association between daily flight volume and arrival delay severity.

**H₁ (Alternative hypothesis)**
Daily flight volume is associated with arrival delay severity.

**Statistical Test**

Monthly aggregates were computed and analyzed using **Spearman’s rank correlation**, which:

* does not assume linearity

* is robust to non-normal distributions

* measures monotonic relationships
```{webr-r}
monthly_volume_delay <- df_clean %>%
group_by(month) %>%
summarise(
total_flights = n(),
mean_delay = mean(arr_delay, na.rm = TRUE)
)

cor.test(
monthly_volume_delay$total_flights,
monthly_volume_delay$mean_delay,
method = "spearman"
)
```


**Interpretation**
The results show a statistically significant positive correlation (ρ = 0.21, p < 0.001), indicating that days with higher traffic volumes tend to experience longer arrival delays.


**Decision:** 
Reject the null hypothesis **(H₀)**.

**Conclusion:**

Days with higher traffic tend to experience longer arrival delays,

but the effect remains moderate and highly variable.

In other words:

* Traffic contributes to delays

* It is not the dominant factor

## General Conclusion

The evidence points to a clear hierarchy of causes and distinct temporal patterns:

*   **Internal Dominance**: Operational factors (Carrier abuse) and late aircraft arrivals significantly outweigh weather-related disruptions.
*   **Seasonal Rhythm**: Delays are not static; they exhibit significant monthly variations, likely driven by demand peaks.
*   **Traffic Impact**: While higher volume correlates with delays, it is not the sole predictor.

This suggests that improvement strategies should focus on carrier operations and network resilience rather than purely exogenous factors. We will now deepen this by looking at how these delays propagate over time.

