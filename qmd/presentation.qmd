---
title: "Flight Delays Analysis 2024"
author: "Hela Bouhlel"
format: revealjs
webr:
  show-startup-message: false
  emulate-r: true
  packages: ["dplyr", "ggplot2", "tidyr"]
filters:
  - webr
---

## Introduction

- **Objective**: Analyze flight delays in 2024 to identify causes and patterns.
- **Data**: Flight records from 2024.
- **Key Areas**:
  - Descriptive Statistics
  - Causes & Seasonality
  - Temporal Dynamics
  - Airline Performance

## Problématique

- **Impact Économique** : Les retards coûtent environ **30 milliards de dollars par an** à l'industrie mondiale (Source : IATA).
- **Situation Critique (2024)** : En Europe, les retards de gestion du trafic ont atteint un coût de **2,8 milliards d'euros**, avec une ponctualité chutant à 72% (Source : Eurocontrol).
- **Enjeu** : Face à la saturation des infrastructures et aux pénuries, comment restaurer l'efficacité opérationnelle et la rentabilité ?

```{webr-r}
#| context: setup
#| include: false
url <- "https://raw.githubusercontent.com/helabhl/Flight-Delays-Analysis/refs/heads/main/qmd/data/flight_2024.csv"
df <- read.csv(url)
```

## Méthodologie et Questions de Recherche

| Axe | Question | Analyse |
|-----|----------|---------|
| **Ampleur** | Les retards sont-ils fréquents/sévères ? | % Retards, Distribution |
| **Compagnies** | Disparités et impact du volume ? | Boxplots, Corrélation |
| **Temps** | Saisonnalité marquée ? | Moyenne mensuelle |
| **Causes** | Internes vs Externes ? | Répartition par cause |
| **Dynamique** | Annulations et Effet Cascade ? | Corrélations |

## 1. Fréquence et Sévérité

> **Q : Les retards sont-ils une minorité ou la norme ?**

- Analyse : Part des vols retardés (>15 min) et distribution des délais.

```{webr-r}
#| fig-height: 4
library(dplyr)
library(ggplot2)

# Global stats
stats <- df %>%
  summarise(
    Total = sum(arr_flights, na.rm = TRUE),
    Delayed = sum(arr_del15, na.rm = TRUE),
    Pct_Delay = Delayed / Total,
    Avg_Delay = sum(arr_delay, na.rm = TRUE) / Total
  )

# Bar chart
vals <- data.frame(
  Etat = c("A l'heure", "Retard (>15m)"),
  Count = c(stats$Total - stats$Delayed, stats$Delayed)
)

ggplot(vals, aes(x = "", y = Count, fill = Etat)) +
  geom_col() + coord_polar(theta = "y") +
  theme_void() + scale_fill_manual(values = c("steelblue", "tomato")) +
  labs(title = paste0("Taux de Retard : ", round(stats$Pct_Delay * 100, 1), "%"))
```

## 2. Performance des Compagnies

> **Q : Toutes les compagnies sont-elles égales face aux retards ?**

- Analyse : Comparaison des distributions de retard moyen par vol.

```{webr-r}
#| fig-height: 4
df_carrier <- df %>%
  filter(arr_flights > 0) %>%
  mutate(avg_delay_flight = arr_delay / arr_flights)

ggplot(df_carrier, aes(x = reorder(carrier_name, avg_delay_flight, FUN=median), y = avg_delay_flight)) +
  geom_boxplot(outlier.shape = NA, fill = "lightblue") +
  coord_flip(ylim = c(0, 40)) +
  labs(title = "Dispersion du Retard Moyen par Compagnie", x = "", y = "Minutes de retard par vol") +
  theme_minimal()
```

## Volume vs Performance

> **Q : Le volume de vols influence-t-il la régularité ?**

```{webr-r}
#| fig-height: 4
vol_stats <- df %>%
  group_by(carrier_name) %>%
  summarise(
    Vol_Total = sum(arr_flights, na.rm = TRUE),
    Retard_Moyen = sum(arr_delay, na.rm=TRUE) / sum(arr_flights, na.rm=TRUE)
  )

ggplot(vol_stats, aes(x = Vol_Total, y = Retard_Moyen, label = carrier_name)) +
  geom_point(color = "darkred", size = 3) +
  theme_minimal() +
  labs(title = "Volume vs Retard Moyen", x = "Nombre de Vols", y = "Retard Moyen")
```

## 3. Saisonnalité et Aéroports

> **Q : Quand et où les retards surviennent-ils ?**

```{webr-r}
#| fig-height: 3.5
monthly <- df %>%
  group_by(month) %>%
  summarise(Avg_Delay = sum(arr_delay, na.rm=TRUE) / sum(arr_flights, na.rm=TRUE))

ggplot(monthly, aes(x = factor(month), y = Avg_Delay)) +
  geom_col(fill = "orange") +
  labs(title = "Saisonnalité : Retard Moyen par Mois", x = "Mois", y = "Retard (min)") +
  theme_minimal()
```

## 4. Causes des Retards

> **Q : Quelles sont les causes dominantes ?**

```{webr-r}
#| fig-height: 4
library(tidyr)
causes <- df %>%
  summarise(
    Carrier = sum(carrier_delay, na.rm=TRUE),
    Weather = sum(weather_delay, na.rm=TRUE),
    NAS = sum(nas_delay, na.rm=TRUE),
    Security = sum(security_delay, na.rm=TRUE),
    Late_Aircraft = sum(late_aircraft_delay, na.rm=TRUE)
  ) %>%
  pivot_longer(everything(), names_to="Cause", values_to="Minutes")

ggplot(causes, aes(x = reorder(Cause, Minutes), y = Minutes, fill=Cause)) +
  geom_col() + coord_flip() +
  labs(title = "Répartition des Minutes de Retard", x = "", y = "") +
  theme_minimal() + theme(legend.position="none")
```

## 5. Effet Domino (Cascade)

> **Q : Les retards s'accumulent-ils ?**

- Le "Late Aircraft Delay" mesure l'impact des rotations précédentes.

```{webr-r}
#| fig-height: 4
# Correlation between Late Aircraft and Total Delay
ggplot(df, aes(x = late_aircraft_delay/arr_flights, y = arr_delay/arr_flights)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "Effet Cascade : Late Aircraft vs Total Delay", x = "Retard Avions Précédents (moy)", y = "Retard Total (moy)") +
  theme_minimal()
```

## Synthèse et Recommandations

- **Constat** : Forte hétérogénéité entre compagnies, pics estivaux marqués.
- **Leurre** : La météo est un facteur mineur par rapport aux causes opérationnelles (Carrier + Late Aircraft).
- **Levier** : Agir sur les "Carrier Delays" pour réduire l'amorçage de l'effet cascade.
